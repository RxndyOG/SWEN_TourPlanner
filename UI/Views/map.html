<!DOCTYPE html>
<html>
<head>
    <title>OpenRouteService Map</title>
    <meta charset="utf-8" />
    <style>
        html, body, #map { height: 100%; margin: 0; padding: 0; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/openrouteservice-js@2.6.0/dist/openrouteservice.min.js"></script>
    <script src="Scripts/L.Routing.OpenRouteServiceV2.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        var map = L.map('map').setView([48.2082, 16.3738], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

        var routingControl = null;

        async function geocode(address) {
            // OpenRouteService Geocoding API
            const apiKey = '';
            const url = `https://api.openrouteservice.org/geocode/search?api_key=${apiKey}&text=${encodeURIComponent(address)}`;
            const response = await fetch(url);
            const data = await response.json();
            if (data.features && data.features.length > 0) {
                return data.features[0].geometry.coordinates.reverse(); // [lat, lng]
            }
            throw new Error('Adresse nicht gefunden: ' + address);
        }

        async function setRoute(from, to) {
            console.log("setRoute called with:", from, to);
            try {
                const fromCoords = await geocode(from);
                const toCoords = await geocode(to);

                if (routingControl) {
                    map.removeControl(routingControl);
                }
                routingControl = L.Routing.control({
                    waypoints: [
                        L.latLng(fromCoords[0], fromCoords[1]),
                        L.latLng(toCoords[0], toCoords[1])
                    ],
                    router: L.Routing.openrouteserviceV2('', {
                        profile: 'driving-car',
                        format: 'geojson'
                    })
                }).addTo(map);
            } catch (e) {
                alert(e.message);
            }
        }
    </script>
</body>
</html>